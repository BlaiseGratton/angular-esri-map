!function(e){"use strict";e.module("esri.map",[]),e.module("esri.map").factory("esriLoader",["$q",function(r){function t(t){var n=r.defer();e.isDefined(window.esri)&&n.reject("ESRI API is already loaded."),t=e.isDefined(t)?t:{};var i=document.createElement("script");return i.type="text/javascript",i.src=t.url||"http://js.arcgis.com/3.14compact",i.onload=function(){n.resolve(window.esri)},document.body.appendChild(i),n.promise}function n(){return e.isDefined(window.esri)}function i(t,i){var o=r.defer();return n()?(e.isString(t)?require([t],function(r){i&&e.isFunction(i)&&i(r),o.resolve(r)}):e.isArray(t)?require(t,function(){var r=Array.prototype.slice.call(arguments);i&&e.isFunction(i)&&i.apply(this,r),o.resolve(r)}):o.reject("An Array<String> or String is required to load modules."),o.promise):(o.reject("Trying to call esriLoader.require(), but esri API has not been loaded yet. Run esriLoader.bootstrap() if you are lazy loading esri ArcGIS API."),o.promise)}return{bootstrap:t,isLoaded:n,require:i}}])}(angular),function(e){"use strict";e.module("esri.map").service("esriRegistry",["$q",function(e){var r={};return{_register:function(t,n){r[t]||(r[t]=e.defer());var i=r[t];return n.promise.then(function(e){return i.resolve(e),e},function(e){return i.reject(e),e}),function(){delete r[t]}},get:function(t){if(r[t])return r[t].promise;var n=e.defer();return r[t]=n,n.promise}}}])}(angular),function(e){"use strict";e.module("esri.map").directive("esriMap",["$q","$timeout","esriRegistry",function(r,t,n){return{restrict:"E",scope:{center:"=?",zoom:"=?",itemInfo:"=?",basemap:"@",load:"&",extentChange:"&",mapOptions:"&"},compile:function(e,r){return e.removeAttr("id"),e.append("<div id="+r.id+"></div>"),function(){}},controller:["$scope","$element","$attrs",function(i,o,a){var s=r.defer();if(a.registerAs){var c=n._register(a.registerAs,s);i.$on("$destroy",c)}require(["esri/map","esri/arcgis/utils","esri/geometry/Extent","esri/dijit/Popup"],function(r,n,o,c){var u=i.mapOptions()||{};if(u.hasOwnProperty("extent")&&"esri.geometry.Extent"!==u.extent.declaredClass&&(u.extent=new o(u.extent)),u.hasOwnProperty("infoWindow")&&(u.infoWindow=new c(u.infoWindow.options,u.infoWindow.srcNodeRef)),a.webmapId)n.createMap(a.webmapId,a.id,{mapOptions:u}).then(function(e){s.resolve(e.map);var r=e.map.geographicExtent.getCenter();i.center.lng=r.x,i.center.lat=r.y,i.zoom=e.map.getZoom(),i.itemInfo=e.itemInfo});else{u.extent||(i.center.lng&&i.center.lat?u.center=[i.center.lng,i.center.lat]:i.center&&(u.center=i.center),i.zoom&&(u.zoom=i.zoom)),i.basemap&&(u.basemap=i.basemap);var d=new r(a.id,u);s.resolve(d)}s.promise.then(function(r){r.on("load",function(){a.load&&i.$apply(function(){i.load()(r)})}),i.$watch("basemap",function(e,t){r.loaded&&e!==t&&r.setBasemap(e)}),i.inUpdateCycle=!1,e.isUndefined(i.center)&&e.isUndefined(i.zoom)||i.$watchGroup(["center.lng","center.lat","zoom"],function(e){i.inUpdateCycle||""!==e[0]&&""!==e[1]&&""!==e[2]&&(i.inUpdateCycle=!0,r.centerAndZoom([e[0],e[1]],e[2]).then(function(){i.inUpdateCycle=!1}))}),r.on("extent-change",function(e){i.inUpdateCycle||(i.inUpdateCycle=!0,i.$apply(function(){if(4326===e.extent.spatialReference.wkid||e.extent.spatialReference.isWebMercator()){var n=r.geographicExtent.getCenter();i.center.lng=n.x,i.center.lat=n.y,i.zoom=r.getZoom()}a.extentChange&&i.extentChange()(e),t(function(){i.inUpdateCycle=!1},0)}))}),i.$on("$destroy",function(){r.destroy()})})}),this.getMap=function(){return s.promise},this.addLayer=function(e){return this.getMap().then(function(r){return r.addLayer(e)})},this.addLayerInfo=function(e){this.layerInfos?this.layerInfos.push(e):this.layerInfos=[e]},this.getLayerInfos=function(){return this.layerInfos}}]}}])}(angular),function(e){"use strict";e.module("esri.map").directive("esriFeatureLayer",["$q",function(e){return{restrict:"E",require:["esriFeatureLayer","^esriMap"],replace:!0,controller:["$scope","$element","$attrs",function(r,t,n){var i=e.defer();require(["esri/layers/FeatureLayer"],function(e){var r=new e(n.url);i.resolve(r)}),this.getLayer=function(){return i.promise},this.setVisible=function(r){var t=e.defer();return this.getLayer().then(function(e){r?e.show():e.hide(),t.resolve()}),t.promise}}],link:function(e,r,t,n){var i=n[0],o=n[1],a=t.visible||"true",s=e.$eval(a);i.setVisible(s),e.$watch(function(){return e.$eval(t.visible)},function(e,r){e!==r&&i.setVisible(e)}),i.getLayer().then(function(e){return o.addLayer(e),o.addLayerInfo({title:t.title||e.name,layer:e,hideLayers:t.hideLayers?t.hideLayers.split(","):void 0,defaultSymbol:t.defaultSymbol?JSON.parse(t.defaultSymbol):!0}),e})}}}])}(angular),function(e){"use strict";e.module("esri.map").directive("esriLegend",["$document","$q",function(r,t){return{priority:-10,scope:{},replace:!0,require:["^esriMap"],link:function(r,n,i,o){var a=o[0],s=i.targetId||i.id,c=t.defer();require(["esri/dijit/Legend","dijit/registry"],function(t,n){a.getMap().then(function(i){var o={map:i},u=a.getLayerInfos();u&&(o.layerInfos=u);var d=n.byId(s);d&&d.destroyRecursive(),d=new t(o,s),d.startup(),r.layers=d.layers,e.forEach(r.layers,function(e,t){r.$watch("layers["+t+"].renderer",function(){d.refresh()})}),c.resolve(d)})})}}}])}(angular);