!function(e){"use strict";e.module("esri.map",[]),e.module("esri.map").factory("esriLoader",["$q",function(t){function r(r){var n=t.defer();e.isDefined(window.esri)&&n.reject("ESRI API is already loaded."),r=e.isDefined(r)?r:{};var i=document.createElement("script");return i.type="text/javascript",i.src=r.url||"http://js.arcgis.com/3.14compact",i.onload=function(){n.resolve(window.esri)},document.body.appendChild(i),n.promise}function n(){return e.isDefined(window.esri)}function i(r,i){var o=t.defer();return n()?(e.isString(r)?require([r],function(t){i&&e.isFunction(i)&&i(t),o.resolve(t)}):e.isArray(r)?require(r,function(){var t=Array.prototype.slice.call(arguments);i&&e.isFunction(i)&&i.apply(this,t),o.resolve(t)}):o.reject("An Array<String> or String is required to load modules."),o.promise):(o.reject("Trying to call esriLoader.require(), but esri API has not been loaded yet. Run esriLoader.bootstrap() if you are lazy loading esri ArcGIS API."),o.promise)}return{bootstrap:r,isLoaded:n,require:i}}])}(angular),function(e){"use strict";e.module("esri.map").service("esriRegistry",["$q",function(e){var t={};return{_register:function(r,n){t[r]||(t[r]=e.defer());var i=t[r];return n.promise.then(function(e){return i.resolve(e),e},function(e){return i.reject(e),e}),function(){delete t[r]}},get:function(r){if(t[r])return t[r].promise;var n=e.defer();return t[r]=n,n.promise}}}])}(angular),function(e){"use strict";e.module("esri.map").directive("esriMap",["$q","$timeout","$log","esriRegistry",function(t,r,n,i){return{restrict:"E",scope:{center:"=?",zoom:"=?",itemInfo:"=?",basemap:"@",load:"&",extentChange:"&",mapOptions:"&"},compile:function(e,t){return e.removeAttr("id"),e.append("<div id="+t.id+"></div>"),function(){}},controller:["$scope","$element","$attrs",function(o,a,s){var c=t.defer();if(s.registerAs){var u=i._register(s.registerAs,c);o.$on("$destroy",u)}require(["esri/map","esri/arcgis/utils","esri/geometry/Extent","esri/dijit/Popup"],function(t,i,a,u){var d=o.mapOptions()||{};if(d.hasOwnProperty("extent")&&"esri.geometry.Extent"!==d.extent.declaredClass&&(d.extent=new a(d.extent)),d.hasOwnProperty("infoWindow")&&(d.infoWindow=new u(d.infoWindow.options,d.infoWindow.srcNodeRef)),s.webmapId)i.createMap(s.webmapId,s.id,{mapOptions:d}).then(function(e){c.resolve(e.map);var t=e.map.geographicExtent.getCenter();o.center.lng=t.x,o.center.lat=t.y,o.zoom=e.map.getZoom(),o.itemInfo=e.itemInfo});else{d.extent||(o.center.lng&&o.center.lat?d.center=[o.center.lng,o.center.lat]:o.center&&(d.center=o.center),o.zoom&&(d.zoom=o.zoom)),o.basemap&&(d.basemap=o.basemap);var l=new t(s.id,d);c.resolve(l)}c.promise.then(function(t){t.on("load",function(){s.load&&o.$apply(function(){o.load()(t)})}),o.$watch("basemap",function(e,r){t.loaded&&e!==r&&t.setBasemap(e)}),o.inUpdateCycle=!1,e.isUndefined(o.center)&&e.isUndefined(o.zoom)||o.$watchGroup(["center.lng","center.lat","zoom"],function(e,r){o.inUpdateCycle||(n.log("center/zoom changed",e,r),""!==e[0]&&""!==e[1]&&""!==e[2]&&(o.inUpdateCycle=!0,t.centerAndZoom([e[0],e[1]],e[2]).then(function(){n.log("after centerAndZoom()"),o.inUpdateCycle=!1})))}),t.on("extent-change",function(e){o.inUpdateCycle||(o.inUpdateCycle=!0,n.log("extent-change: ",e.extent),n.log("extent-change geographic: ",t.geographicExtent),o.$apply(function(){if(4326===e.extent.spatialReference.wkid||e.extent.spatialReference.isWebMercator()){var i=t.geographicExtent.getCenter();o.center.lng=i.x,o.center.lat=i.y,o.zoom=t.getZoom()}s.extentChange&&o.extentChange()(e),r(function(){n.log("after apply()"),o.inUpdateCycle=!1},0)}))}),o.$on("$destroy",function(){t.destroy()})})}),this.getMap=function(){return c.promise},this.addLayer=function(e){return this.getMap().then(function(t){return t.addLayer(e)})},this.addLayerInfo=function(e){this.layerInfos?this.layerInfos.push(e):this.layerInfos=[e]},this.getLayerInfos=function(){return this.layerInfos}}]}}])}(angular),function(e){"use strict";e.module("esri.map").directive("esriFeatureLayer",["$q",function(e){return{restrict:"E",require:["esriFeatureLayer","^esriMap"],replace:!0,controller:["$scope","$element","$attrs",function(t,r,n){var i=e.defer();require(["esri/layers/FeatureLayer"],function(e){var t=new e(n.url);i.resolve(t)}),this.getLayer=function(){return i.promise},this.setVisible=function(t){var r=e.defer();return this.getLayer().then(function(e){t?e.show():e.hide(),r.resolve()}),r.promise}}],link:function(e,t,r,n){var i=n[0],o=n[1],a=r.visible||"true",s=e.$eval(a);i.setVisible(s),e.$watch(function(){return e.$eval(r.visible)},function(e,t){e!==t&&i.setVisible(e)}),i.getLayer().then(function(e){return o.addLayer(e),o.addLayerInfo({title:r.title||e.name,layer:e,hideLayers:r.hideLayers?r.hideLayers.split(","):void 0,defaultSymbol:r.defaultSymbol?JSON.parse(r.defaultSymbol):!0}),e})}}}])}(angular),function(e){"use strict";e.module("esri.map").directive("esriLegend",["$document","$q",function(t,r){return{priority:-10,scope:{},replace:!0,require:["^esriMap"],link:function(t,n,i,o){var a=o[0],s=i.targetId||i.id,c=r.defer();require(["esri/dijit/Legend","dijit/registry"],function(r,n){a.getMap().then(function(i){var o={map:i},u=a.getLayerInfos();u&&(o.layerInfos=u);var d=n.byId(s);d&&d.destroyRecursive(),d=new r(o,s),d.startup(),t.layers=d.layers,e.forEach(t.layers,function(e,r){t.$watch("layers["+r+"].renderer",function(){d.refresh()})}),c.resolve(d)})})}}}])}(angular);